<!DOCTYPE html>
<meta charset="utf-8">

<body>
<!-- <script src="//d3js.org/d3.v3.min.js"></script> -->
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<link rel="stylesheet" href="style.css">
<script src="app.js"></script>

<p class="header">Are you a March 1st fan? Haven't seen a game all year? Well don't worry, we didn't miss any!</p>

<div id="navbar">
  <div id="page1Div" class="selected">Win & Where</div>
  <div id="page2Div" class="">The more you know</div>
  <div id="page3Div" class="">How far should they go?</div>
</div>

<script type="text/javascript">
  $('#page1Div').on("click", function (event) {
     // your code here...
     console.log("Page 1 Clicked");

     $('#page1Div').removeClass("selected");
     $('#page2Div').removeClass("selected");
     $('#page3Div').removeClass("selected");
     $('#page1Div').addClass("selected");

     document.getElementById('chart').style.display = 'block';
     document.getElementById('menu').style.display = 'block';
     document.getElementById('subheader1').style.display = 'block';

     document.getElementById('breakdownMenu').style.display = 'none';
     document.getElementById('breakdownChart').style.display = 'none';
     document.getElementById('subheader2').style.display = 'none';

     document.getElementById('circleChart').style.display = 'none';
     document.getElementById('result').style.display = 'none';
     document.getElementById('score').style.display = 'none';
     document.getElementById('subheader3').style.display = 'none';
  });

  $('#page2Div').on("click", function (event) {
     // your code here...
     console.log("Page 2 Clicked");

    $('#page1Div').removeClass("selected");
    $('#page2Div').removeClass("selected");
    $('#page3Div').removeClass("selected");
    $('#page2Div').addClass("selected");

     document.getElementById('chart').style.display = 'none';
     document.getElementById('menu').style.display = 'none';
     document.getElementById('subheader1').style.display = 'none';

     document.getElementById('breakdownMenu').style.display = 'block';
     document.getElementById('breakdownChart').style.display = 'block';
     document.getElementById('subheader2').style.display = 'block';

     document.getElementById('circleChart').style.display = 'none';
     document.getElementById('result').style.display = 'none';
     document.getElementById('score').style.display = 'none';
     document.getElementById('subheader3').style.display = 'none';
  });

  $('#page3Div').on("click", function (event) {
     // your code here...
     console.log("Page 3 Clicked");

     $('#page1Div').removeClass("selected");
     $('#page2Div').removeClass("selected");
     $('#page3Div').removeClass("selected");
     $('#page3Div').addClass("selected");

     document.getElementById('chart').style.display = 'none';
     document.getElementById('menu').style.display = 'none';
     document.getElementById('subheader1').style.display = 'none';

     document.getElementById('breakdownMenu').style.display = 'none';
     document.getElementById('breakdownChart').style.display = 'none';
     document.getElementById('subheader2').style.display = 'none';

     document.getElementById('circleChart').style.display = 'block';
     document.getElementById('result').style.display = 'block';
     document.getElementById('score').style.display = 'block';
     document.getElementById('subheader3').style.display = 'block';
  });
</script>

<div class="wrapper">
  <!-- Page 1 -->
  <p id="subheader1" class="subheader">Find out who was winning the most!</p>
  <p id="subheader2" class="subheader" style="display:none">Find out a little more!</p>
  <p id="subheader3" class="subheader" style="display:none">See where your team should fit in based on history!</p>

  <div id="menu" class="group">
    <div class="selected">Wins</div>
    <div class="">Loses</div>
  </div>
  <div id="chart"></div>

  <!-- Page 2 -->
  <div id="breakdownMenu" class="group" style="display: none">
    <div class="selected">PPG</div>
    <div>RPG</div>
    <div>APG</div>
    <div>FG</div>
    <div>Round Eliminated</div>
  </div>
  <div id="breakdownChart" style="display: none"></div>

  <!-- Page 3 -->
  <div id="circleChart">
		<svg>
		</svg>
	</div>

	<div id="result"></div>
	<div id="score"></div>

</div>

<script>
  //Page 1
  var barHeight = 20, width = 450, numPlayers = 64, parameter1 = 'Wins';
  var data = [], yScale = null;
  var menu1 = [
    {id: 'Wins', name: 'Wins'},
    {id: 'Loses', name: 'Loses'}
  ];

  //// UI
  function menuClick1(d) {
    if(parameter1 === d.id)
      return;

    d3.select('#menu').selectAll('div').classed('selected', false);
    d3.select(this).classed('selected', true);

    parameter1 = d.id;

    updateChart1();
  }
  //// HELPER FUNCTIONS
  function px(s) {
    return s + 'px';
  }
  //// D3
  function updateScale() {
    yScale = d3.scale.linear()
      .domain([0, d3.max(data, function(d) { return d[parameter1]; })])
      .range([0, width]);
  }
  function updateChart1() {
    updateScale();

    d3.select('#chart')
      .selectAll('div.bar')
      .transition()
      .duration(2000)
      .style('width', function(d) {
        return px(yScale(d[parameter1]));
      });

    d3.select('#chart')
      .selectAll('div.value')
      .transition()
      .duration(2000)
      .tween("text", function(d) {
        // Thanks to http://stackoverflow.com/questions/13454993/increment-svg-text-with-transistion
        var i = d3.interpolate(this.textContent, d[parameter1]);
        return function(t) {
            this.textContent = Math.round(i(t));
        };
      });
  }

  d3.csv('2015NCAAData_Full.csv', function(err, csv) {
    data = csv;//filterPlayers(csv);

    updateScale();

    var players = d3.select('#chart')
      .selectAll('div')
      .data(data)
      .enter()
      .append('div')
      .sort(function(a, b) {return d3.descending(a[parameter1], b[parameter1]);})
      .classed('player', true)
      .style('top', function(d, i) {
        return px(i * barHeight);
      });

    players.append('div')
      .classed('label', true)
      .text(function(d) {return d.Team;});

    players.append('div')
      .classed('bar', true)
      .style('height', px(barHeight * 0.95))
      .style('width', function(d) {
        return px(yScale(d[parameter1]));
      });

    players.append('div')
      .classed('value', true)
      .text(function(d) {return (d[parameter1]);});

    // Menu
    console.log(d3.select('#menu')
      .selectAll('div'));
    d3.select('#menu')
      .selectAll('div')
      .data(menu1)
      .text(function(d) {return d.name;})
      .classed('selected', function(d, i) {return i==0;})
      .on('click',menuClick1);
  });
</script>

<script>
  var radius = 35, padding = 1, cols = 16, parameter = 'PPG';
  var menu = [
    {id: 'PPG', name: 'PPG'},
    {id: 'RPG', name: 'RPG'},
    {id: 'APG', name: 'APG'},
    {id: 'FG', name: 'FG'},
    {id: 'Round_Eliminated', name: 'Round Eliminated'}
  ];

  //// UI
  function menuClick(d) {
    if(parameter === d.id)
      return;

    d3.select('#breakdownMenu').selectAll('div').classed('selected', false);
    d3.select(this).classed('selected', true);

    parameter = d.id;

    updateChart();
  }

  function selectThis(d) {
    d3.select(this).classed('selected', function() {return !d3.select(this).classed('selected');})
  }

  //// D3
  function updateChart() {
    var players = d3.select('#breakdownChart')
      .selectAll('div.team')
      .sort(function(a, b) {return parameter === 'ranking' ? d3.ascending(+a[parameter], +b[parameter]) : d3.descending(+a[parameter], +b[parameter]);})
      .transition()
      .duration(2000)
      .style('left', function(d, i) {
        var col = i % cols;
        var x = 2 * col * (radius + padding);
        return x + 'px';
      })
      .style('top', function(d, i) {
        var row = Math.floor(i / cols);
        var y = 2 * row * (radius + padding);
        return y + 'px';
      });

    d3.select('#breakdownChart')
      .selectAll('div.team .breakdownValue')
      .transition()
      .duration(0)
      .tween("text", function(d) {
        // Thanks to http://stackoverflow.com/questions/13454993/increment-svg-text-with-transistion
        var i = d3.interpolate(this.textContent, +d[parameter]);
        return function(t) {
            this.textContent = i(t);//Math.round(i(t));
        };
      });
  }

  d3.csv('2015NCAAData_Full.csv', function(err, csv2) {

    var teams = d3.select('#breakdownChart')
      .selectAll('div')
      .data(csv2)
      .enter()
      .append('div')
      .attr('id', function(d) {return d.Team;})
      .classed('team', true)
      .style('width', 2 * radius + 'px')
      .style('height', 2 * radius + 'px')
      .on('click', selectThis);

    teams
      .append('div')
      .classed('name', true)
      .text(function(d) {return d.Team;})
      .style('width', 2 * radius);

    teams
      .append('div')
      .classed('breakdownValue', true)
      .text(function(d) {return d[parameter];})
      .style('width', 2 * radius);

    updateChart();

    // Menu
    console.log(d3.select('#breakdownMenu')
      .selectAll('div'));
    d3.select('#breakdownMenu')
      .selectAll('div')
      .data(menu)
      // .enter()
      // .append('div')
      .text(function(d) {return d.name;})
      .classed('selected', function(d, i) {return i==0;})
      .on('click', menuClick);
  });
</script>

<!-- <script>
  d3.json('data/tree.json', function(err, root) {
    // console.log(root);
    var chart = svg.append('g');
    chart.datum(root).selectAll('g')
      .data(partition.nodes)
      .enter()
      .append('g');

    // We use three groups: segments, round labels & player labels. This is to achieve a layering effect.

    // Segments
    chart.selectAll('g')
      .append('path')
      .attr('d', arc)
      .on('mouseover', playerHover);

    // Round labels
    var rounds = ['Round 1', 'Round 2', 'Round 3', 'Round 4', 'Quarter finals', 'Semi finals', 'Final'];
    var roundLabels = svg.append('g').attr('id', 'round-labels');
    roundLabels.selectAll('path')
      .data(rounds)
      .enter()
      .append('path')
      .attr('d', function(d, i) {
        var offset = (numRounds - i + 0.5) * segmentWidth - 10;
        return arcSVG(-offset, 0, offset, offset, 0, 1, 1, offset, 0);
      })
      .style({'fill': 'none', 'stroke': 'none'})
      .attr('id', function(d, i) {return 'round-label-'+ +(i+1);});

    roundLabels.selectAll('text')
      .data(rounds)
      .enter()
      .append('text')
      .append('textPath')
      .attr('xlink:href', function(d, i) {return '#round-label-'+ +(i+1);})
      .attr('startOffset', '50%')
      .text(function(d) {return d;});


    // Player labels
    var playerLabels = svg.append('g').attr('id', 'player-labels');
    playerLabels.datum(root).selectAll('g')
      .data(partition.nodes)
      .enter()
      .append('text')
      .text(function(d, i) {return i === 0 ? surname(d) : d.name.slice(0, 3);})
      .attr('transform', label)
      .attr('dy', '0.4em')
      .attr('class', function(d) {return surname(d)+' round-'+ +(d.round);});

  });
</script> -->

</body>
